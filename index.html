<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI vs 플레이어 오목</title>
  <style>
    canvas {
      border: 2px solid #333;
      background-color: #f0d9b5;
    }
    body { font-family: sans-serif; text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>AI vs 플레이어 오목</h2>
  <p id="status">플레이어(흑)의 차례입니다.</p>
  <canvas id="board" width="600" height="600"></canvas>
  <script>
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    const size = 15;
    const cell = canvas.width / size;
    const board = Array.from({ length: size }, () => Array(size).fill(null));
    let gameOver = false;

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < size; i++) {
        ctx.beginPath();
        ctx.moveTo(cell / 2, cell / 2 + i * cell);
        ctx.lineTo(canvas.width - cell / 2, cell / 2 + i * cell);
        ctx.moveTo(cell / 2 + i * cell, cell / 2);
        ctx.lineTo(cell / 2 + i * cell, canvas.height - cell / 2);
        ctx.stroke();
      }
    }

    function drawStone(x, y, color) {
      ctx.beginPath();
      ctx.arc(x * cell + cell / 2, y * cell + cell / 2, cell / 2 - 2, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.stroke();
    }

    function checkWin(x, y, who) {
      const dirs = [[1,0],[0,1],[1,1],[1,-1]];
      for (let [dx, dy] of dirs) {
        let count = 1;
        for (let i = 1; i < 5; i++) {
          let nx = x + dx * i, ny = y + dy * i;
          if (nx < 0 || ny < 0 || nx >= size || ny >= size || board[ny][nx] !== who) break;
          count++;
        }
        for (let i = 1; i < 5; i++) {
          let nx = x - dx * i, ny = y - dy * i;
          if (nx < 0 || ny < 0 || nx >= size || ny >= size || board[ny][nx] !== who) break;
          count++;
        }
        if (count >= 5) return true;
      }
      return false;
    }

    function evaluate(x, y, who) {
      let score = 0;
      const dirs = [[1,0],[0,1],[1,1],[1,-1]];
      for (let [dx, dy] of dirs) {
        let count = 1;
        for (let i = 1; i < 5; i++) {
          let nx = x + dx * i, ny = y + dy * i;
          if (nx < 0 || ny < 0 || nx >= size || ny >= size || board[ny][nx] !== who) break;
          count++;
        }
        for (let i = 1; i < 5; i++) {
          let nx = x - dx * i, ny = y - dy * i;
          if (nx < 0 || ny < 0 || nx >= size || ny >= size || board[ny][nx] !== who) break;
          count++;
        }
        if (count === 5) score += 100000;
        else if (count === 4) score += 10000;
        else if (count === 3) score += 1000;
        else if (count === 2) score += 100;
      }
      return score;
    }

    function aiMove() {
      let bestScore = -1;
      let move = null;
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          if (board[y][x]) continue;
          board[y][x] = 'white';
          let score = evaluate(x, y, 'white') + evaluate(x, y, 'black');
          board[y][x] = null;
          if (score > bestScore) {
            bestScore = score;
            move = [x, y];
          }
        }
      }
      if (move) {
        const [x, y] = move;
        board[y][x] = 'white';
        drawStone(x, y, 'white');
        if (checkWin(x, y, 'white')) {
          document.getElementById('status').textContent = 'AI(백)이 승리했습니다!';
          gameOver = true;
        } else {
          document.getElementById('status').textContent = '플레이어(흑)의 차례입니다.';
        }
      }
    }

    canvas.addEventListener('click', function(e) {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / cell);
      const y = Math.floor((e.clientY - rect.top) / cell);
      if (board[y][x]) return;
      board[y][x] = 'black';
      drawStone(x, y, 'black');
      if (checkWin(x, y, 'black')) {
        document.getElementById('status').textContent = '플레이어(흑)가 승리했습니다!';
        gameOver = true;
        return;
      }
      document.getElementById('status').textContent = 'AI(백)의 차례입니다...';
      setTimeout(aiMove, 300);
    });

    drawBoard();
  </script>
</body>
</html>
